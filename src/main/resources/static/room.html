<!doctype html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì±„íŒ… í…ŒìŠ¤íŠ¸</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.6.1/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
</head>
<body>
<h1>ì±„íŒ… í…ŒìŠ¤íŠ¸ í˜ì´ì§€</h1>

<form id="messageForm">
    <input type="text" id="senderId" placeholder="ë³´ë‚´ëŠ” ì‚¬ëŒ ID" required />
    <input type="text" id="senderType" placeholder="ë³´ë‚´ëŠ” ì‚¬ëŒ íƒ€ì… (e.g. USER)" required />
    <input type="text" id="content" placeholder="ë©”ì‹œì§€ ë‚´ìš©" required />
    <button type="submit">ë³´ë‚´ê¸°</button>
</form>

<ul id="chatMessages"></ul>

<script>
    const chatRoomId = 38; // í…ŒìŠ¤íŠ¸í•  ì±„íŒ…ë°© ID
    const socket = new SockJS("/ws");
    const stompClient = Stomp.over(socket);

    stompClient.connect({}, function (frame) {
        console.log("ğŸ“¡ ì—°ê²°ë¨:", frame);

        stompClient.subscribe(`/topic/chat.room.${chatRoomId}`, function (message) {
            const data = JSON.parse(message.body);
            const listItem = document.createElement("li");
            listItem.textContent = `[${data.sentAt}] ${data.senderId} (${data.senderType}) : ${data.content}`;
            document.getElementById("chatMessages").prepend(listItem);
        });
    });

    document.getElementById("messageForm").addEventListener("submit", function (e) {
        e.preventDefault();

        const senderId = document.getElementById("senderId").value.trim();
        const senderType = document.getElementById("senderType").value.trim();
        const content = document.getElementById("content").value.trim();

        if (!senderId || !senderType || !content) {
            alert("ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return;
        }

        stompClient.send(
            `/app/chat/rooms/${chatRoomId}/messages/create`,
            {},
            JSON.stringify({ senderId, senderType, content })
        );

        document.getElementById("content").value = "";
    });
</script>
</body>
</html>
