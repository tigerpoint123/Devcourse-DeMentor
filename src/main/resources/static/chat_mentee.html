<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>WebSocket Chat Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 2rem; }
        #chatMessages li { margin-bottom: 0.5rem; }
    </style>
</head>
<body>
<h2>ğŸ’¬ WebSocket Chat Test</h2>

<input type="text" id="messageInput" placeholder="Type your message..." />
<button onclick="sendMessage()">Send</button>

<ul id="chatMessages"></ul>

<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>

<script>
    const token = "Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJtZW50ZWVAdGVzdC5jb20iLCJhdXRoIjoiUk9MRV9NRU5URUUiLCJuaWNrbmFtZSI6Iu2FjOyKpO2KuOupmO2LsCIsIm1lbWJlcklkIjoxNCwiaWF0IjoxNzQzOTk4MjY0LCJleHAiOjE3NDQwMzQyNjR9.azfu8o_zG_B3f53bnDiTRnh_FGmIFWov-us-YLR58sQ4mU4X_plcHyS8qaQ_FzGruorhkFKwnRx4SPvwa-qDcQ";
    const chatRoomId = 35;

    const socket = new SockJS("http://localhost:8080/ws");
    const stompClient = Stomp.over(socket);

    // WebSocket ì—°ê²° ì‹œë„
    stompClient.connect({ Authorization: token }, function (frame) {
        console.log("âœ… WebSocket ì—°ê²° ì„±ê³µ:", frame);

        // ì±„íŒ…ë°© êµ¬ë…
        stompClient.subscribe("/sub/chat/room/" + chatRoomId, function (message) {
            const msg = JSON.parse(message.body);
            console.log("ğŸ“¥ ìˆ˜ì‹ í•œ ë©”ì‹œì§€:", msg);

            const listItem = document.createElement("li");
            listItem.textContent = `[${msg.nickname}] ${msg.content}`;
            document.getElementById("chatMessages").appendChild(listItem);
        });
    }, function (error) {
        console.error("âŒ WebSocket ì—°ê²° ì‹¤íŒ¨:", error);
    });

    // ë©”ì‹œì§€ ì „ì†¡ í•¨ìˆ˜
    function sendMessage() {
        const messageContent = document.getElementById("messageInput").value;

        if (!messageContent) {
            alert("ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”!");
            return;
        }

        console.log("ğŸ“¤ ë©”ì‹œì§€ ì „ì†¡:", messageContent);

        stompClient.send("/pub/chat/message", { Authorization: token }, JSON.stringify({
            chatRoomId: chatRoomId,
            message: messageContent,
            type: "MESSAGE"
        }));

        document.getElementById("messageInput").value = "";
    }
</script>
</body>
</html>
